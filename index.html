<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>
<body>
	<script>
		const isValid = chaveAcesso => {
		  if (!chaveAcesso || chaveAcesso.trim().length !== 44) {
		    return false
		  }

		  const chaveParcial = chaveAcesso.substring(0, 43)
		  const multiplicadores = [2, 3, 4, 5, 6, 7, 8, 9]

		  let i = 42
		  let somaPonderada = 0

		  while (i >= 0) {
		    for (let j = 0; (j < multiplicadores.length && i >= 0); j++) {
		      somaPonderada += chaveParcial[i] * multiplicadores[j]
		      i -= 1
		    }
		  }

		  const resto = somaPonderada % 11
		  const dv = (resto === 0 || resto === 1) ? 0 : 11 - resto

		  return String(dv) === chaveAcesso.substring(43, 44)
		}

		$(function(){
			$('[name=chave-nfe]').on('change keyup', (e) => {
				let r = isValid( $($(e.currentTarget)[0]).val());

				if (r) {
					$('.result').html('Digito verificador v√°lido!')
				} else {
					$('.result').html('')
				}
			})
		})

	</script>
	<style type="text/css">
		body {
			display: flex;
			justify-content: center;
		}

		.wrapper {
			align-items: center;
			display: flex;
			flex-direction: column;
		}

		input {
			border: 1px solid #ddd;
			display: block;
			height: 50px;
			font-family: sans-serif;
			text-align: center;
			width: 350px;
		}

		.result {
			display: block;
			font-weight: bold;
			font-family: sans-serif;
			text-align: center;
		}
	</style>

	<div class="wrapper">
		<h3>Validador de digito verificador</h3>
		<br>
		<input maxlength="44" name="chave-nfe" placeholder="Insira a chave da nota fiscal para validar">
		<br>
		<span class="result"></span>
	</div>
</body>
</html>
